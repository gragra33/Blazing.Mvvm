@inherits ComponentControlBase

@if (_panels != null)
{
    <CascadingValue Value=this>
        @_panels
    </CascadingValue>
}

<div @attributes="AdditionalAttributes"
     class ="@GetTabsClass()" style="@GetTabsStyle()">
    <div class="@GetHeaderClass()" style="@GetHeaderStyle()" role="tablist">
        @foreach (TabPanel tabPanel in _panels!)
        {
            <button type="button" role="tab"
                    id="@tabPanel.HeaderUniqueId"
                    class="@GetButtonClass(tabPanel)" style="@GetButtonStyle(tabPanel)"
                    tabindex="@(tabPanel.Selected ? 0 : -1)"
                    aria-selected="@tabPanel.Selected" aria-controls="@tabPanel.UniqueId"
                    @onclick="@(() => ActivatePage(tabPanel))"
                    @onkeydown="@(async arg => await OnKeyDown(arg))"
                    @onkeydown:preventDefault="true"
                    @onkeydown:stopPropagation="true">
                @if (tabPanel.HeaderTemplate == null)
                {
                    <span class="@GetButtonTitleClass()" style="@GetButtonTitleStyle()">
                        @((MarkupString)tabPanel.Title!)
                    </span>
                }
                else
                {
                    @tabPanel.HeaderTemplate
                }
            </button>
        }
    </div>

    @if (_activePanel != null)
    {
        <div @attributes="_activePanel.AdditionalAttributes"
             id="@_activePanel.UniqueId" 
             class="@GetTabPanelClass(_activePanel)" style="@GetTabPanelStyle(_activePanel)"
             tabindex="0" role="tabpanel"
             aria-labelledby="@_activePanel.HeaderUniqueId">
            @_activePanel!.ChildContent
        </div>
    }
</div>